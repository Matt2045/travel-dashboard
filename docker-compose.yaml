services:
  dashboard:
    env_file:
      - .env.production
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Build-Zeit Variablen (öffentlich - gehen ins Frontend)
        VITE_SYNCFUSION_LICENSE_KEY: ${VITE_SYNCFUSION_LICENSE_KEY}
        VITE_APPWRITE_PROJECT_ID: ${VITE_APPWRITE_PROJECT_ID}
        VITE_APPWRITE_API_ENDPOINT: ${VITE_APPWRITE_API_ENDPOINT}
        VITE_APPWRITE_DATABASE_ID: ${VITE_APPWRITE_DATABASE_ID}
        VITE_APPWRITE_USERS_COLLECTION_ID: ${VITE_APPWRITE_USERS_COLLECTION_ID}
        VITE_APPWRITE_TRIPS_COLLECTION_ID: ${VITE_APPWRITE_TRIPS_COLLECTION_ID}
    container_name: dashboard-app
    restart: unless-stopped
    ports:
      - "3001:3000"
    environment:
      # Runtime Variablen (Secrets - nur auf dem Server verfügbar)
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - UNSPLASH_ACCESS_KEY=${UNSPLASH_ACCESS_KEY}
      - SENTRY_AUTH_TOKEN=${SENTRY_AUTH_TOKEN}
      # Öffentliche Variablen für SSR
      - VITE_APPWRITE_PROJECT_ID=${VITE_APPWRITE_PROJECT_ID}
      - VITE_APPWRITE_API_ENDPOINT=${VITE_APPWRITE_API_ENDPOINT}
      - VITE_APPWRITE_DATABASE_ID=${VITE_APPWRITE_DATABASE_ID}
      - VITE_APPWRITE_USERS_COLLECTION_ID=${VITE_APPWRITE_USERS_COLLECTION_ID}
      - VITE_APPWRITE_TRIPS_COLLECTION_ID=${VITE_APPWRITE_TRIPS_COLLECTION_ID}
      - VITE_SYNCFUSION_LICENSE_KEY=${VITE_SYNCFUSION_LICENSE_KEY}
    networks:
      - dashboard-network

networks:
  dashboard-network:
    driver: bridge
